<!DOCTYPE html>
<html>
<head>
  <title>Model Relationships</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }
    
    canvas {
      background: #f5f5f5;
      width: 100%;
      height: 100vh;
    }
    
    .legend {
      position: absolute;
      top: 20px;
      right: 20px;
      background: white;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      margin: 5px 0;
    }
    
    .legend-color {
      width: 15px;
      height: 15px;
      margin-right: 8px;
      border-radius: 3px;
    }
  </style>
</head>
<body>
  <div class="legend">
    <div class="legend-item">
      <div class="legend-color" style="background: #4CAF50;"></div>
      Core Models
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #2196F3;"></div>
      Business Models
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #FF9800;"></div>
      Product Models
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #9C27B0;"></div>
      Location Models
    </div>
  </div>
  
  <canvas id="modelCanvas"></canvas>
  <script>
    const canvas = document.getElementById('modelCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // Model categories and colors
    const modelCategories = {
      core: { color: '#4CAF50', models: ['Location', 'Company', 'CurrencyEx'] },
      business: { color: '#2196F3', models: ['BG', 'BU', 'PlantDistrict', 'Plant'] },
      product: { color: '#FF9800', models: ['Product', 'ProductShareVer', 'PDBUProduct'] },
      location: { color: '#9C27B0', models: ['Supplier', 'SupplierPOD', 'Machine', 'Asset', 'Customer', 'ShippingSite'] }
    };

    // Model positions and dimensions
    const models = {
      Location: { x: 100, y: 50, width: 180, height: 60 },
      Company: { x: 350, y: 50, width: 180, height: 60 },
      BG: { x: 600, y: 50, width: 180, height: 60 },
      BU: { x: 850, y: 50, width: 180, height: 60 },
      PlantDistrict: { x: 100, y: 200, width: 180, height: 60 },
      Plant: { x: 350, y: 200, width: 180, height: 60 },
      Supplier: { x: 600, y: 200, width: 180, height: 60 },
      SupplierPOD: { x: 850, y: 200, width: 180, height: 60 },
      CurrencyEx: { x: 100, y: 350, width: 180, height: 60 },
      Machine: { x: 350, y: 350, width: 180, height: 60 },
      Asset: { x: 600, y: 350, width: 180, height: 60 },
      Customer: { x: 850, y: 350, width: 180, height: 60 },
      ShippingSite: { x: 100, y: 500, width: 180, height: 60 },
      Product: { x: 350, y: 500, width: 180, height: 60 },
      ProductShareVer: { x: 600, y: 500, width: 180, height: 60 },
      PDBUProduct: { x: 850, y: 500, width: 180, height: 60 }
    };

    // Relationships data
    const relationships = [
      { from: 'Location', to: 'PlantDistrict', label: 'has location', oneToMany: true },
      { from: 'Location', to: 'SupplierPOD', label: 'delivery location', oneToMany: true },
      { from: 'Location', to: 'ShippingSite', label: 'shipping location', oneToMany: true },
      { from: 'Company', to: 'PlantDistrict', label: 'owns', oneToMany: true },
      { from: 'Company', to: 'ShippingSite', label: 'billing company', oneToMany: true },
      { from: 'BG', to: 'BU', label: 'contains', oneToMany: true },
      { from: 'BU', to: 'Plant', label: 'operates in', oneToMany: true },
      { from: 'PlantDistrict', to: 'Plant', label: 'contains', oneToMany: true },
      { from: 'PlantDistrict', to: 'PDBUProduct', label: 'produces', oneToMany: true },
      { from: 'Plant', to: 'Machine', label: 'contains', oneToMany: true },
      { from: 'Supplier', to: 'SupplierPOD', label: 'has delivery points', oneToMany: true },
      { from: 'SupplierPOD', to: 'Machine', label: 'supplies', oneToMany: true },
      { from: 'Machine', to: 'Asset', label: 'has assets', oneToMany: true },
      { from: 'Customer', to: 'ShippingSite', label: 'has sites', oneToMany: true },
      { from: 'Customer', to: 'Product', label: 'orders', oneToMany: true },
      { from: 'Product', to: 'ProductShareVer', label: 'shares versions', oneToMany: true },
      { from: 'Product', to: 'PDBUProduct', label: 'has variations', oneToMany: true }
    ];

    // Draw model boxes
    function drawModels() {
      ctx.font = '14px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      
      for (const [name, pos] of Object.entries(models)) {
        // Get category color
        const category = Object.values(modelCategories).find(cat => 
          cat.models.includes(name)
        );
        const color = category ? category.color : '#ccc';
        
        // Draw box
        ctx.fillStyle = color + '33'; // 20% opacity
        ctx.strokeStyle = color;
        ctx.lineWidth = 2;
        ctx.fillRect(pos.x, pos.y, pos.width, pos.height);
        ctx.strokeRect(pos.x, pos.y, pos.width, pos.height);
        
        // Draw text
        ctx.fillStyle = '#333';
        ctx.fillText(name, pos.x + pos.width/2, pos.y + pos.height/2);
      }
    }

    // Function to draw arrowhead
    function drawArrowhead(x, y, angle) {
      const size = 8;
      ctx.save();
      ctx.translate(x, y);
      ctx.rotate(angle);
      ctx.beginPath();
      ctx.moveTo(0, 0);
      ctx.lineTo(-size, -size/2);
      ctx.lineTo(-size, size/2);
      ctx.closePath();
      ctx.fillStyle = '#666';
      ctx.fill();
      ctx.restore();
    }

    // Draw relationships
    function drawRelationships() {
      ctx.strokeStyle = '#666';
      ctx.lineWidth = 2;
      ctx.font = '12px Arial';
      ctx.fillStyle = '#333';
      
      relationships.forEach(rel => {
        const from = models[rel.from];
        const to = models[rel.to];
        
        // Calculate control points for curve
        const startX = from.x + from.width/2;
        const startY = from.y + from.height;
        const endX = to.x + to.width/2;
        const endY = to.y;
        const cp1x = startX + (endX - startX) * 0.5;
        const cp1y = startY + 50;
        const cp2x = endX - (endX - startX) * 0.5;
        const cp2y = endY - 50;
        
        // Draw curved line
        ctx.beginPath();
        ctx.moveTo(startX, startY);
        ctx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, endX, endY);
        ctx.stroke();
        
        // Draw arrowhead for 1:many relationships
        if (rel.oneToMany) {
          // Calculate angle at end of curve
          const t = 0.99; // near the end of the curve
          const dx = 3*(1-t)*(1-t)*(cp1x-startX) + 6*(1-t)*t*(cp2x-cp1x) + 3*t*t*(endX-cp2x);
          const dy = 3*(1-t)*(1-t)*(cp1y-startY) + 6*(1-t)*t*(cp2y-cp1y) + 3*t*t*(endY-cp2y);
          const angle = Math.atan2(dy, dx);
          
          // Calculate arrowhead position
          const arrowX = Math.pow(1-t,3)*startX + 3*Math.pow(1-t,2)*t*cp1x + 3*(1-t)*Math.pow(t,2)*cp2x + Math.pow(t,3)*endX;
          const arrowY = Math.pow(1-t,3)*startY + 3*Math.pow(1-t,2)*t*cp1y + 3*(1-t)*Math.pow(t,2)*cp2y + Math.pow(t,3)*endY;
          
          drawArrowhead(arrowX, arrowY, angle);
        }
        
        // Draw label
        const midX = (startX + endX) / 2;
        const midY = (startY + endY) / 2;
        ctx.save();
        ctx.translate(midX, midY);
        ctx.rotate(Math.atan2(endY - startY, endX - startX));
        ctx.fillText(rel.label, 10, -5);
        ctx.restore();
      });
    }

    // Draw everything
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawModels();
      drawRelationships();
      requestAnimationFrame(draw);
    }

    draw();
  </script>
</body>
</html>
